local RunService = game:GetService("RunService")
local Lighting = game:GetService("Lighting")

-- Function to reset the lighting to original settings
local function resetLighting()
    Lighting.Ambient = Color3.fromRGB(255, 255, 255)
    Lighting.OutdoorAmbient = Color3.fromRGB(128, 128, 128)
    Lighting.Brightness = 2
    Lighting.FogColor = Color3.fromRGB(255, 255, 255)
    Lighting.FogStart = 0
    Lighting.FogEnd = 1000
    if Lighting:FindFirstChild("Sky") then
        Lighting.Sky:Destroy()
    end
    local defaultSky = Instance.new("Sky")
    defaultSky.SkyboxBk = "rbxassetid://0"
    defaultSky.SkyboxDn = "rbxassetid://0"
    defaultSky.SkyboxFt = "rbxassetid://0"
    defaultSky.SkyboxLf = "rbxassetid://0"
    defaultSky.SkyboxRt = "rbxassetid://0"
    defaultSky.SkyboxUp = "rbxassetid://0"
    defaultSky.Parent = Lighting
end

-- Function to create colorful firework effects that change color smoothly
local function createFireworks()
    local fireworkList = {}

    for i = 1, 10 do
        local firework = Instance.new("Part")
        firework.Size = Vector3.new(0.5, 0.5, 0.5)
        firework.Position = Vector3.new(math.random(-100, 100), math.random(40, 100), math.random(-100, 100))
        firework.Anchored = true
        firework.CanCollide = false
        firework.Name = "Firework"
        firework.Parent = workspace

        local particleEmitter = Instance.new("ParticleEmitter")
        particleEmitter.Color = ColorSequence.new(Color3.new(1, 0, 0), Color3.new(0, 1, 0), Color3.new(0, 0, 1), Color3.new(1, 0, 1))
        particleEmitter.Lifetime = NumberRange.new(1, 2)
        particleEmitter.Rate = 200
        particleEmitter.Speed = NumberRange.new(50, 100)
        particleEmitter.Size = NumberSequence.new(2, 4)
        particleEmitter.Parent = firework

        local bodyPosition = Instance.new("BodyPosition")
        bodyPosition.MaxForce = Vector3.new(0, math.huge, 0)
        bodyPosition.Position = firework.Position
        bodyPosition.Parent = firework

        coroutine.wrap(function()
            while firework do
                local hue = tick() % 5 / 5
                local color = Color3.fromHSV(hue, 1, 1)
                particleEmitter.Color = ColorSequence.new(color, Color3.new(math.random(), math.random(), math.random()))
                wait(0.1)
            end
        end)()

        table.insert(fireworkList, firework)
    end

    -- Sync fireworks with the song
    local audioPlaying = true

    RunService.Heartbeat:Connect(function()
        if audioPlaying then
            for _, firework in ipairs(fireworkList) do
                local bobbingHeight = math.sin(tick() * 2) * 5
                firework.Position = firework.Position + Vector3.new(0, bobbingHeight, 0)
            end
        end
    end)

    return fireworkList
end

-- Function to create cool additional fireworks around sparklers
local function createAdditionalFireworks(parentPart)
    for i = 1, 3 do -- Multiple effects per sparkler
        local additionalFirework = Instance.new("Part")
        additionalFirework.Size = Vector3.new(0.5, 0.5, 0.5)
        additionalFirework.Position = parentPart.Position + Vector3.new(math.random(-5, 5), math.random(10, 15), math.random(-5, 5))
        additionalFirework.Anchored = true
        additionalFirework.CanCollide = false
        additionalFirework.Name = "AdditionalFirework"
        additionalFirework.Parent = workspace

        -- Burst effect
        local burstEmitter = Instance.new("ParticleEmitter")
        burstEmitter.Color = ColorSequence.new(Color3.new(1, 0, 0), Color3.new(0, 1, 0), Color3.new(0, 0, 1), Color3.new(1, 0.5, 0))
        burstEmitter.Lifetime = NumberRange.new(1, 1.5)
        burstEmitter.Rate = 500
        burstEmitter.Speed = NumberRange.new(40, 60)
        burstEmitter.Size = NumberSequence.new(1.5, 2)
        burstEmitter.Parent = additionalFirework

        -- Star-shaped effect
        local starEmitter = Instance.new("ParticleEmitter")
        starEmitter.Texture = "rbxassetid://75418583814408" -- Star-shaped particle texture
        starEmitter.Lifetime = NumberRange.new(0.5, 1)
        starEmitter.Rate = 100
        starEmitter.Speed = NumberRange.new(20, 40)
        starEmitter.Size = NumberSequence.new(1, 1.5)
        starEmitter.Parent = additionalFirework

        -- Randomized color bursts
        coroutine.wrap(function()
            while additionalFirework do
                burstEmitter.Color = ColorSequence.new(Color3.fromHSV(math.random(), 1, 1))
                wait(0.5)
            end
        end)()
    end
end

-- Function to create sparklers around the fireworks with colorful particle effects
local function createSparklers(fireworkList)
    for _, firework in ipairs(fireworkList) do
        local sparkler = Instance.new("Part")
        sparkler.Size = Vector3.new(0.2, 0.2, 0.2)
        sparkler.Position = firework.Position
        sparkler.Anchored = true
        sparkler.CanCollide = false
        sparkler.Parent = workspace

        local sparklerEmitter = Instance.new("ParticleEmitter")
        sparklerEmitter.Color = ColorSequence.new(Color3.new(1, 1, 0), Color3.new(1, 0.5, 0))
        sparklerEmitter.Lifetime = NumberRange.new(0.5, 1)
        sparklerEmitter.Rate = 500
        sparklerEmitter.Speed = NumberRange.new(10, 20)
        sparklerEmitter.Size = NumberSequence.new(0.5, 1)
        sparklerEmitter.Parent = sparkler

        -- Add more fireworks to the sparklers
        createAdditionalFireworks(sparkler)
    end
end

-- Lighting Effects for Theme
Lighting.Ambient = Color3.fromRGB(255, 140, 0)
Lighting.OutdoorAmbient = Color3.fromRGB(10, 10, 10)
Lighting.Brightness = 2
Lighting.FogColor = Color3.fromRGB(255, 100, 0)
Lighting.FogStart = 200
Lighting.FogEnd = 800
local sky = Instance.new("Sky")
sky.SkyboxBk = "rbxassetid://159454299"
sky.SkyboxDn = "rbxassetid://159454299"
sky.SkyboxFt = "rbxassetid://159454299"
sky.SkyboxLf = "rbxassetid://159454299"
sky.SkyboxRt = "rbxassetid://159454299"
sky.SkyboxUp = "rbxassetid://159454299"
sky.Parent = Lighting

-- Sound Setup
local audioId = "rbxassetid://16190782786"
local sound = Instance.new("Sound")
sound.SoundId = audioId
sound.Looped = false
sound.Volume = 1
sound.Parent = workspace
sound:Play()

-- Create fireworks and sparklers
local fireworkList = createFireworks()
createSparklers(fireworkList)

-- Reset lighting after the sound finishes playing
sound.Ended:Connect(function()
    resetLighting()
end)
