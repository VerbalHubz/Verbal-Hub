local RunService = game:GetService("RunService")
local Lighting = game:GetService("Lighting")
local Players = game:GetService("Players")
local player = Players.LocalPlayer
local character = player.Character or player.CharacterAdded:Wait()

-- Store original lighting settings
local originalLighting = {
    Ambient = Lighting.Ambient,
    OutdoorAmbient = Lighting.OutdoorAmbient,
    Brightness = Lighting.Brightness,
    FogColor = Lighting.FogColor,
    FogStart = Lighting.FogStart,
    FogEnd = Lighting.FogEnd,
}

-- Function to reset the lighting to original settings
local function resetLighting()
    -- Remove existing sky
    for _, child in pairs(Lighting:GetChildren()) do
        if child:IsA("Sky") then
            child:Destroy()
        end
    end

    -- Restore original lighting effects
    Lighting.Ambient = originalLighting.Ambient
    Lighting.OutdoorAmbient = originalLighting.OutdoorAmbient
    Lighting.Brightness = originalLighting.Brightness
    Lighting.FogColor = originalLighting.FogColor
    Lighting.FogStart = originalLighting.FogStart
    Lighting.FogEnd = originalLighting.FogEnd
end

-- Function to create colorful firework effects that change color smoothly
local function createFireworks()
    local fireworkList = {}

    for i = 1, 10 do
        local firework = Instance.new("Part")
        firework.Size = Vector3.new(0.5, 0.5, 0.5)
        firework.Position = Vector3.new(math.random(-100, 100), math.random(40, 100), math.random(-100, 100))
        firework.Anchored = true
        firework.CanCollide = false
        firework.Name = "Firework"
        firework.Parent = workspace

        local particleEmitter = Instance.new("ParticleEmitter")
        particleEmitter.Color = ColorSequence.new(Color3.new(1, 0, 0), Color3.new(0, 1, 0), Color3.new(0, 0, 1), Color3.new(1, 0, 1))
        particleEmitter.Lifetime = NumberRange.new(1, 2)
        particleEmitter.Rate = 200
        particleEmitter.Speed = NumberRange.new(50, 100)
        particleEmitter.Size = NumberSequence.new(2, 4)
        particleEmitter.Parent = firework

        coroutine.wrap(function()
            while firework do
                local hue = tick() % 5 / 5
                local color = Color3.fromHSV(hue, 1, 1)
                particleEmitter.Color = ColorSequence.new(color, Color3.new(math.random(), math.random(), math.random()))
                wait(0.1)
            end
        end)()

        table.insert(fireworkList, firework)
    end

    return fireworkList
end

-- Function to create additional fireworks around sparklers
local function createAdditionalFireworks(parentPart)
    for i = 1, 3 do
        local additionalFirework = Instance.new("Part")
        additionalFirework.Size = Vector3.new(0.5, 0.5, 0.5)
        additionalFirework.Position = parentPart.Position + Vector3.new(math.random(-5, 5), math.random(10, 15), math.random(-5, 5))
        additionalFirework.Anchored = true
        additionalFirework.CanCollide = false
        additionalFirework.Name = "AdditionalFirework"
        additionalFirework.Parent = workspace

        local burstEmitter = Instance.new("ParticleEmitter")
        burstEmitter.Color = ColorSequence.new(Color3.new(1, 0, 0), Color3.new(0, 1, 0), Color3.new(0, 0, 1), Color3.new(1, 0.5, 0))
        burstEmitter.Lifetime = NumberRange.new(1, 1.5)
        burstEmitter.Rate = 500
        burstEmitter.Speed = NumberRange.new(40, 60)
        burstEmitter.Size = NumberSequence.new(1.5, 2)
        burstEmitter.Parent = additionalFirework

        coroutine.wrap(function()
            while additionalFirework do
                burstEmitter.Color = ColorSequence.new(Color3.fromHSV(math.random(), 1, 1))
                wait(0.5)
            end
        end)()
    end
end

-- Function to create dynamic thunder and lighting effects
local function createThunderEffect()
    while true do
        wait(math.random(2, 5))
        Lighting.Brightness = 10
        wait(0.1)
        Lighting.Brightness = 2
    end
end

-- Function to create rainbow rain
local function createRainbowRain()
    local rainDrops = 0
    while rainDrops < 5000 do
        wait(0.1) -- Change the interval for more or less rain
        local r = Instance.new("Part")
        r.Size = Vector3.new(0.2, 2, 0.2)
        r.BrickColor = BrickColor.Random()
        r.Material = Enum.Material.Neon
        r.CanCollide = false
        r.Anchored = true
        r.CFrame = CFrame.new(math.random(-100, 100), 100, math.random(-100, 100))
        r.Parent = workspace
        rainDrops = rainDrops + 1
    end
end

-- Function to create jump sync for the player
local function jumpSync(duration)
    local jumpTime = tick() + duration
    while tick() < jumpTime do
        character:Move(Vector3.new(0, 50, 0), true) -- Make the player jump
        wait(0.5) -- Adjust the jump interval
    end
end

-- Lighting Effects for Theme
Lighting.Ambient = Color3.fromRGB(255, 140, 0)
Lighting.OutdoorAmbient = Color3.fromRGB(10, 10, 10)
Lighting.Brightness = 2
Lighting.FogColor = Color3.fromRGB(255, 100, 0)
Lighting.FogStart = 200
Lighting.FogEnd = 800
local sky = Instance.new("Sky")
sky.SkyboxBk = "rbxassetid://159454299"
sky.SkyboxDn = "rbxassetid://159454299"
sky.SkyboxFt = "rbxassetid://159454299"
sky.SkyboxLf = "rbxassetid://159454299"
sky.SkyboxRt = "rbxassetid://159454299"
sky.SkyboxUp = "rbxassetid://159454299"
sky.Parent = Lighting

-- Sound Setup
local audioId = "rbxassetid://16190782786"
local sound = Instance.new("Sound")
sound.SoundId = audioId
sound.Looped = false
sound.Volume = 1
sound.Parent = workspace
sound:Play()

-- Create fireworks and sparklers
local fireworkList = createFireworks()

-- Start the rain effect
createRainbowRain()

-- Start thunder effects
coroutine.wrap(createThunderEffect)()

-- Make the player jump sync for 10 seconds
coroutine.wrap(jumpSync)(10)

-- Wait for the song to finish and then reset everything
sound.Ended:Wait()

-- Remove all fireworks and rain
for _, obj in ipairs(workspace:GetChildren()) do
    if obj.Name == "Firework" or obj.Name == "AdditionalFirework" or obj.Name == "RainbowRain" then
        obj:Destroy()
    end
end

-- Reset lighting and remove all lighting effects
resetLighting()
