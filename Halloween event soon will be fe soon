local RunService = game:GetService("RunService")
local Lighting = game:GetService("Lighting")
local Players = game:GetService("Players")

-- Store original lighting settings
local originalLighting = {
    Ambient = Lighting.Ambient,
    OutdoorAmbient = Lighting.OutdoorAmbient,
    Brightness = Lighting.Brightness,
    FogColor = Lighting.FogColor,
    FogStart = Lighting.FogStart,
    FogEnd = Lighting.FogEnd,
}

-- Function to reset the lighting to original settings
local function resetLighting()
    -- Remove existing sky
    for _, child in pairs(Lighting:GetChildren()) do
        if child:IsA("Sky") then
            child:Destroy()
        end
    end

    -- Restore original lighting effects
    Lighting.Ambient = originalLighting.Ambient
    Lighting.OutdoorAmbient = originalLighting.OutdoorAmbient
    Lighting.Brightness = originalLighting.Brightness
    Lighting.FogColor = originalLighting.FogColor
    Lighting.FogStart = originalLighting.FogStart
    Lighting.FogEnd = originalLighting.FogEnd
end

-- Function to create colorful firework effects
local function createFireworks()
    local fireworkList = {}

    for i = 1, 30 do  -- Increased the number of fireworks
        local firework = Instance.new("Part")
        firework.Size = Vector3.new(1, 1, 1)
        firework.Position = Vector3.new(math.random(-100, 100), math.random(40, 100), math.random(-100, 100))
        firework.Anchored = true
        firework.CanCollide = false
        firework.Name = "Firework"
        firework.Parent = workspace

        local particleEmitter = Instance.new("ParticleEmitter")
        particleEmitter.Color = ColorSequence.new(Color3.new(1, 0, 0), Color3.new(1, 1, 0), Color3.new(0, 1, 0), Color3.new(0, 1, 1), Color3.new(0, 0, 1), Color3.new(1, 0, 1))
        particleEmitter.Lifetime = NumberRange.new(1, 2)
        particleEmitter.Rate = 150
        particleEmitter.Speed = NumberRange.new(50, 100)
        particleEmitter.Size = NumberSequence.new(2, 5) -- Increased size of particles
        particleEmitter.Parent = firework

        coroutine.wrap(function()
            while firework do
                local hue = tick() % 5 / 5
                local color = Color3.fromHSV(hue, 1, 1)
                particleEmitter.Color = ColorSequence.new(color, Color3.new(math.random(), math.random(), math.random()))
                wait(0.1)
            end
        end)()

        table.insert(fireworkList, firework)
    end

    -- Sync fireworks with the song
    local audioPlaying = true

    RunService.Heartbeat:Connect(function()
        if audioPlaying then
            for _, firework in ipairs(fireworkList) do
                local bobbingHeight = math.sin(tick() * 2) * 5
                firework.Position = firework.Position + Vector3.new(0, bobbingHeight, 0)
            end
        end
    end)

    return fireworkList
end

-- Function to create dynamic thunder and lightning effects
local function createThunderEffect()
    while true do
        wait(math.random(2, 5))  -- Wait between strikes
        Lighting.Brightness = 10  -- Increase brightness to simulate lightning
        wait(0.1)                 -- Short flicker
        Lighting.Brightness = 2   -- Return to normal
    end
end

-- Function to create a disco ball effect with changing light colors
local function createDiscoBall()
    local discoBall = Instance.new("Part")
    discoBall.Size = Vector3.new(3, 3, 3)
    discoBall.Material = Enum.Material.SmoothPlastic
    discoBall.BrickColor = BrickColor.White()
    discoBall.Anchored = true
    discoBall.Position = Vector3.new(0, 50, 0)  -- Position above the ground
    discoBall.Name = "DiscoBall"
    discoBall.Parent = workspace

    -- SpotLight to simulate disco lighting around the ball
    local spotLight = Instance.new("SpotLight")
    spotLight.Parent = discoBall
    spotLight.Range = 15
    spotLight.Brightness = 2
    spotLight.Angle = 45  -- Beam angle for the spotlight
    spotLight.Color = Color3.fromRGB(255, 255, 255)  -- Initial color white

    -- Rotate the disco ball for effect
    RunService.Heartbeat:Connect(function()
        discoBall.CFrame = discoBall.CFrame * CFrame.Angles(0, math.rad(2), 0)  -- Rotate disco ball
        
        -- Change light color based on time for a disco effect
        local hue = tick() % 5 / 5  -- Cycling hue
        spotLight.Color = Color3.fromHSV(hue, 1, 1)  -- Disco light color change
    end)

    return discoBall
end

-- Function to create rainbow rain effect
local function createRainbowRain()
    local rainCount = 0
    while rainCount < 5000 do  -- Limit to a maximum number of raindrops
        wait(0.01)  -- Adjust the drop frequency for visibility
        local rainDrop = Instance.new("Part")
        rainDrop.Size = Vector3.new(0.2, 1, 0.2)
        rainDrop.BrickColor = BrickColor.new(Color3.new(math.random(), math.random(), math.random())) -- Rainbow color
        rainDrop.Material = Enum.Material.SmoothPlastic
        rainDrop.CanCollide = false
        rainDrop.Position = Vector3.new(math.random(-100, 100), 200, math.random(-100, 100))  -- Start above ground
        rainDrop.Anchored = false
        
        -- Make the raindrop fall
        local bodyVelocity = Instance.new("BodyVelocity", rainDrop)
        bodyVelocity.Velocity = Vector3.new(0, -50, 0)  -- Falling speed
        bodyVelocity.MaxForce = Vector3.new(0, math.huge, 0) -- Allow it to fall
        rainCount = rainCount + 1
        rainDrop.Parent = workspace

        -- Clean up raindrop after it falls
        wait(2)  -- Time before cleaning up, adjust as needed
        rainDrop:Destroy()
    end
end

-- Function to create blue fire effects around the map
local function createBlueFire()
    local fireList = {}
    for i = 1, 20 do  -- Adjust the number of fire effects
        local fire = Instance.new("Part")
        fire.Size = Vector3.new(1, 1, 1)
        fire.Position = Vector3.new(math.random(-100, 100), 1, math.random(-100, 100))  -- Position near the ground
        fire.Anchored = true
        fire.CanCollide = false
        fire.BrickColor = BrickColor.new(Color3.fromRGB(0, 0, 255))  -- Blue color
        fire.Material = Enum.Material.Neon
        fire.Parent = workspace

        local particleEmitter = Instance.new("ParticleEmitter")
        particleEmitter.Color = ColorSequence.new(Color3.fromRGB(0, 0, 255), Color3.fromRGB(0, 0, 150))
        particleEmitter.Lifetime = NumberRange.new(1, 2)
        particleEmitter.Rate = 100
        particleEmitter.Speed = NumberRange.new(0, 1)
        particleEmitter.Size = NumberSequence.new(0.5, 1) -- Size of the particles
        particleEmitter.Parent = fire
        
        table.insert(fireList, fire)
    end
    return fireList
end

-- Lighting Effects for Theme
Lighting.Ambient = Color3.fromRGB(255, 140, 0)
Lighting.OutdoorAmbient = Color3.fromRGB(10, 10, 10)
Lighting.Brightness = 2
Lighting.FogColor = Color3.fromRGB(255, 100, 0)
Lighting.FogStart = 200
Lighting.FogEnd = 800
local sky = Instance.new("Sky")
sky.SkyboxBk = "rbxassetid://159454299"
sky.SkyboxDn = "rbxassetid://159454299"
sky.SkyboxFt = "rbxassetid://159454299"
sky.SkyboxLf = "rbxassetid://159454299"
sky.SkyboxRt = "rbxassetid://159454299"
sky.SkyboxUp = "rbxassetid://159454299"
sky.Parent = Lighting

-- Sound Setup
local audioId = "rbxassetid://16190782786"
local sound = Instance.new("Sound")
sound.SoundId = audioId
sound.Looped = false
sound.Volume = 1
sound.Parent = workspace
sound:Play()

-- Create fireworks
local fireworkList = createFireworks()
-- Create blue fire effects
local fireList = createBlueFire()

-- Start thunder effects
local thunderCoroutine = coroutine.create(createThunderEffect)
coroutine.resume(thunderCoroutine)

-- Start disco ball effect
createDiscoBall()

-- Start rainbow rain effect
createRainbowRain()

-- Reset everything after the song is done
sound.Ended:Connect(function()
    resetLighting()
    for _, fire in ipairs(fireList) do
        fire:Destroy()
    end
    for _, firework in ipairs(fireworkList) do
        firework:Destroy()
    end
end)
